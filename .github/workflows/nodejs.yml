name: CI

on: [push, pull_request]

jobs:
  NodeJS_Lint_Test_Build:
  
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [10.x, 12.x]

    steps:
    - uses: actions/checkout@v1

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}

    - name: Install Dependencies
      run: yarn

    - name: TSLint
      run: yarn run tslint

    - name: Vulnerabilities
      run: yarn audit

    - name: Package .vsce
      run: yarn run  package
    - name: Upload .vsce File
      uses: actions/upload-artifact@v1
      with:
          name: esp-idf-extension.vsix
          path: esp-idf-extension.vsix

    - name: Test
      run: |
        Xvfb :99 & sleep 2
        yarn run test --VERBOSE >> testing.results.log
    - name: Upload testing.results.log
      uses: actions/upload-artifact@v1
      with:
          name: testing.results.log
          path: testing.results.log

      env:
        CI: true
